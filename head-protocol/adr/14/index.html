<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/head-protocol/adr/rss.xml" title="Hydra: Head Protocol RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/head-protocol/adr/atom.xml" title="Hydra: Head Protocol Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hydra: Head Protocol" href="/head-protocol/opensearch.xml">
<script src="https://plausible.io/js/script.js" defer="defer" data-domain="hydra.family"></script><title data-rh="true">14. Token usage in Hydra Scripts | Hydra: Head Protocol</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://input-output-hk.github.io/head-protocol/adr/14"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="14. Token usage in Hydra Scripts | Hydra: Head Protocol"><meta data-rh="true" name="description" content="Status"><meta data-rh="true" property="og:description" content="Status"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-02-14T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="Accepted"><link data-rh="true" rel="icon" href="/head-protocol/img/hydra.png"><link data-rh="true" rel="canonical" href="https://input-output-hk.github.io/head-protocol/adr/14"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/head-protocol/adr/14" hreflang="en"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/head-protocol/fr/adr/14" hreflang="fr"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/head-protocol/ja/adr/14" hreflang="ja"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/head-protocol/adr/14" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://YZTAF8IOVB-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/head-protocol/assets/css/styles.e706d711.css">
<link rel="preload" href="/head-protocol/assets/js/runtime~main.372fac57.js" as="script">
<link rel="preload" href="/head-protocol/assets/js/main.53825789.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/head-protocol/"><div class="navbar__logo"><img src="/head-protocol/img/hydra.png" alt="Hydra: Head Protocol" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/head-protocol/img/hydra-white.png" alt="Hydra: Head Protocol" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Hydra: Head Protocol</b></a><a class="navbar__item navbar__link" href="/head-protocol/docs/getting-started">User Manual</a><a class="navbar__item navbar__link" href="/head-protocol/use-cases">Use Cases</a><a class="navbar__item navbar__link" href="/head-protocol/core-concepts">Core Concepts</a><a class="navbar__item navbar__link" href="/head-protocol/topologies">Topologies</a><a class="navbar__item navbar__link" href="/head-protocol/benchmarks">Benchmarks</a><a class="navbar__item navbar__link" href="/head-protocol/api-reference">API Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/input-output-hk/hydra-poc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/head-protocol/adr/14" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/head-protocol/fr/adr/14" target="_self" rel="noopener noreferrer" class="dropdown__link">Français</a></li><li><a href="/head-protocol/ja/adr/14" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li></ul></div><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Architectural Decision Records</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/1">1. Record Architecture Decisions
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/2">2. Reactive Core
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/3">3. Asynchronous Duplex Client API</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/4">4. Use Handle to model Effects
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/5">5. Use io-classes
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/6">6. Network Broadcasts all messages
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/7">7. Use with-pattern based component interfaces
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/8">8. Custom Prelude
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/9">9. Simplify Logging
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/10">10. Use Direct Connection to `cardano-node`
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/11">11. Use cardano-api
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/12">12. Top-down Test-driven Design
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/13">13. Plutus Contracts Testing Strategy
</a></li><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/head-protocol/adr/14">14. Token usage in Hydra Scripts
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/15">15. Configuration Through an Admin API
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/16">16. Keep Rejected ADRs
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/17">17. Use UDP protocol for Hydra networking
</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/head-protocol/adr/18">18. Single state in Hydra.Node.
</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">14. Token usage in Hydra Scripts
</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-02-14T00:00:00.000Z" itemprop="datePublished">February 14, 2022</time> · <!-- -->3 min read</div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="status">Status<a class="hash-link" href="#status" title="Direct link to heading">​</a></h2><p>Accepted</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">​</a></h2><ul><li>The Hydra on-chain-verification scripts are used to validate Hydra protocol transactions and ensure they are lawful.</li><li>At least these three properties need to be enforced:<ul><li>Authentication: ensure that only Head participants can, for example, <code>abort</code> a Head</li><li>Contract continuity: ensure that a Head was <code>init</code>ialized before it can be opened by a <code>collectCom</code> tx.</li><li>Completeness: ensure that all Head participants had chance to <code>commit</code> funds to a Head.</li></ul></li><li>The Hydra Head paper introduces <strong>participation tokens (PT)</strong> and a <strong>state thread token (ST)</strong> for that matter.</li><li>Such tokens (a.k.a native assets) are identified by the <code>CurrencySymbol</code>, that is the hash of their <code>MintingPolicyScript</code> (a.k.a <code>PolicyID</code> in the ledger), and a <code>ByteString</code>, the socalled <code>TokenName</code> (a.k.a as <code>AssetName</code> in the ledger, see <a href="https://hydra.iohk.io/job/Cardano/cardano-ledger-specs/specs.shelley-ma/latest/download-by-type/doc-pdf/shelley-ma#subsection.3.2" target="_blank" rel="noopener noreferrer">shelley-ma ledger spec</a>)</li><li>There can be multiple Hydra Heads on a network and a <code>hydra-node</code> need to distinguish individual Head instances or even (later) keep track of multiple Heads. Concretely, this means that we need to infer a Head identifier (<code>HeadId</code>) from observing each of the Hydra protocol transactions. </li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="decision">Decision<a class="hash-link" href="#decision" title="Direct link to heading">​</a></h2><ul><li>We solve both challenges by defining that ST and PTs <strong>shall use the same</strong> <code>MintingPolicyScript</code> and thus have same <code>CurrencySymbol</code></li><li>The <code>MintingPolicyScript</code> shall be parameterized by <code>TxOutRef</code> to yield a unique <code>CurrencySymbol</code> per Head
(similar to the <a href="https://github.com/input-output-hk/plutus/tree/1efbb276ef1a10ca6961d0fd32e6141e9798bd11/plutus-use-cases/src/Plutus/Contracts/Currency.hs" target="_blank" rel="noopener noreferrer"><code>OneShotCurrency</code></a> example)</li><li>ST and one PT per participant are minted in the <code>initTx</code></li><li>The <code>TokenName</code> of the ST can be any well-known <code>ByteString</code>, e.g. <code>&quot;HydraHeadV1&quot;</code></li><li>The <code>TokenName</code> of the PTs needs to be the <code>PubKeyHash</code> of the respective participant</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="consequences">Consequences<a class="hash-link" href="#consequences" title="Direct link to heading">​</a></h2><ul><li><p>Heads can be identified by looking for the <code>ST</code> in <code>init</code>, <code>collectCom</code>, <code>close</code>, <code>contest</code> or <code>fanout</code> transactions, or the <code>PT</code> in <code>commit</code> transactions. In both cases, the <code>CurrencySymbol == HeadId</code></p></li><li><p>Our scripts become simpler as we only need to check that ST/PT are paid forward, instead of needing to check datums</p></li><li><p>The datum produced by <code>commit</code> txs (and consumed by <code>collectCom</code>) is <code>Just SerializedTxOut</code>, which is simpler than also keeping the participant which committed in the datum (compare to full life-cycle of <a href="https://github.com/input-output-hk/hydra-poc/tree/0.3.0/docs/images/on-chain-full.jpg" target="_blank" rel="noopener noreferrer">0.3.0</a>).</p></li><li><p>The <code>v_head</code> script validator does not need to be parameterized, which makes discovering new Heads (and also tracking them for metrics) easier as the address to watch for is common to all Heads (of the same <code>v_head</code> version).</p></li><li><p>The <code>v_head</code> script (path) for the abort life-cycle can be implemented already much safer by checking that all PTs are burned on the <code>abort</code> transaction (counting inputs in abort life-cycle of <a href="https://github.com/input-output-hk/hydra-poc/tree/0.3.0/docs/images/on-chain-abort.jpg" target="_blank" rel="noopener noreferrer">0.3.0</a>).</p></li><li><p>Updated diagrams for the <a target="_blank" href="/head-protocol/assets/files/on-chain-full-eea3dda97376810a7bfac1848a11a84a.jpg">full</a> and <a target="_blank" href="/head-protocol/assets/files/on-chain-abort-c3483946d3116662c5cabfd67e3dde4e.jpg">abort</a> on-chain life-cycles of a Hydra Head.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="follow-up-questions">Follow-up questions<a class="hash-link" href="#follow-up-questions" title="Direct link to heading">​</a></h2><ul><li>What value does the <code>ST</code> actually add? We could always look for the <code>PT</code> to identify a Head and contract continuity would already be achieved by the <code>PT</code>s!</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/head-protocol/adr/tags/accepted">Accepted</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/head-protocol/adr/13"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">13. Plutus Contracts Testing Strategy
</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/head-protocol/adr/15"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">15. Configuration Through an Admin API
</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a></li><li><a href="#follow-up-questions" class="table-of-contents__link toc-highlight">Follow-up questions</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/input-output-hk/hydra-poc/wiki/Coding-Standards" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding Standards</a></li><li class="footer__item"><a class="footer__link-item" href="/head-protocol/adr">Architectural Decision Records</a></li><li class="footer__item"><a href="https://github.com/input-output-hk/hydra-poc/wiki/Testing-Strategy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Testing Strategy</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/Qq5vNTg9PT" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord (#ask-hydra)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/input-output-hk/hydra-poc/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://cardano.stackexchange.com/questions/tagged/hydra" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Exchange<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/head-protocol/docs/haskell_packages">Haskell Packages</a></li><li class="footer__item"><a href="https://github.com/input-output-hk/hydra-poc/wiki/Logbook" target="_blank" rel="noopener noreferrer" class="footer__link-item">Logbook</a></li><li class="footer__item"><a href="https://iohk.io/en/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Input Output (Blog)</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 <strong>Input Output</strong> <br> <small>Built with Docusaurus</small></div></div></div></footer></div>
<script src="/head-protocol/assets/js/runtime~main.372fac57.js"></script>
<script src="/head-protocol/assets/js/main.53825789.js"></script>
</body>
</html>